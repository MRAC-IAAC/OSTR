import serial
import time
ser = serial.Serial("COM4",9600)
max_timeout_ack = 10
max_timeout_done = 50

#L system test
commands = ['D','D','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','L90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','R90','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','F10','F10','R90','F10','L90','F10','R90','F10','R90','F10','F10','U','Z']

def draw(commands):
    ser.flush()
    for i in commands:
        if i != 'Z':
            answer = str(i) + '\n'
            ser.write(answer.encode())
            #time.sleep(2)
            arduino()
            time.sleep(0.5)
        else:
            exit()


def arduino():
    timeout_ack=0
    ignore_done = False

    # Try to read ACK in 10 tries
    while True:
        byte_chunk1 = ser.readline().decode("utf-8").replace("\r\n", "")
        timeout_ack += 1

        if byte_chunk1=='ACK':
            print('ACK found')
            break

        if timeout_ack>max_timeout_ack:
            print('ACK not found, ignoring')
            ignore_done = True
            break

    # Try to read DONE in 50 tries
    if ignore_done == False:
        done_not_found = False
        timeout_done=0

        while True:
            byte_chunk2 = ser.readline().decode("utf-8").replace("\r\n", "")
            timeout_done+=1
            if byte_chunk2=='DONE':
                break

            if timeout_done>max_timeout_done:
                print('DONE not found, ignoring')
                done_not_found = True
                break
        print('DONE found')
    if done_not_found:
        print('reset all')

#########################

time.sleep(3)
print('ready')


while True and ser.isOpen():
    draw(commands)

